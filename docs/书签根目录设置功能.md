# 书签根目录设置功能

## 概述

书签根目录设置功能允许用户在设置页面中选择特定的书签文件夹作为主页显示的根目录，从而只显示该文件夹及其子文件夹中的书签，提供更加专注和个性化的书签浏览体验。

## 主要功能

### 🎯 **根目录选择**

1. **树状结构**: 按层级树状显示所有书签文件夹
2. **展开收起**: 点击文件夹名称可展开或收起子文件夹
3. **可视化层级**: 使用缩进和图标清晰显示文件夹层级关系
4. **全部书签**: 默认选项，显示所有书签文件夹
5. **特定文件夹**: 选择任意层级的文件夹作为根目录

### ⚙️ **设置管理**

1. **持久化保存**: 设置自动保存到浏览器本地存储
2. **实时更新**: 设置更改后主页书签立即刷新
3. **错误处理**: 完善的加载和保存错误处理
4. **重试机制**: 失败时提供重试选项

### 🔄 **自动同步**

1. **设置监听**: 主页自动监听设置变化
2. **即时刷新**: 无需手动刷新页面
3. **状态同步**: 确保设置和显示状态一致

## 技术实现

### 数据结构

```typescript
interface BookmarkFolder {
    id: string;           // 文件夹ID
    title: string;        // 文件夹名称
    parentId?: string;    // 父文件夹ID
    path: string;         // 显示路径，如"书签栏/开发工具"
}
```

### 核心函数

#### 1. 获取文件夹树结构
```typescript
export async function getBookmarkFolderTree(): Promise<BookmarkFolder[]>
```
- 递归构建书签文件夹的树状结构
- 保持父子关系和层级信息
- 添加"全部书签"默认选项

#### 2. 获取文件夹列表（平铺）
```typescript
export async function getBookmarkFolders(): Promise<BookmarkFolder[]>
```
- 递归遍历书签树获取所有文件夹的平铺列表
- 用于过滤功能，保持向后兼容

#### 3. 过滤书签树
```typescript
export function filterBookmarksByRoot(
    bookmarks: chrome.bookmarks.BookmarkTreeNode[], 
    rootFolderId: string
): chrome.bookmarks.BookmarkTreeNode[]
```
- 根据根目录ID过滤书签树
- 递归查找指定的根文件夹
- 返回过滤后的书签节点

#### 4. 设置存储
```typescript
export async function saveBookmarkRootSetting(rootFolderId: string): Promise<void>
export async function getBookmarkRootSetting(): Promise<string>
```
- 保存和读取根目录设置
- 使用Chrome storage API
- 默认值为'all'（全部书签）

### 组件架构

#### BookmarkSettings组件
- **状态管理**: 文件夹树结构、当前选择、加载状态
- **用户界面**: 树状选择器、加载动画、错误提示
- **事件处理**: 文件夹选择、展开收起、重试操作

#### TreeSelector组件
- **树状显示**: 按层级显示文件夹结构
- **交互功能**: 支持展开/收起、点击选择
- **视觉效果**: 缩进、图标、选中状态高亮
- **响应式设计**: 适配不同屏幕尺寸

#### Bookmarks组件集成
- **设置监听**: 监听storage变化事件
- **自动刷新**: 设置变更时重新加载书签
- **过滤显示**: 根据设置过滤显示的书签

## 用户界面

### 设置页面

```
📚 书签设置
选择在主页显示的书签根目录，点击文件夹名称可展开或收起

根目录:
┌─────────────────────────────────────┐
│ 📖 所有书签                    ● │
│ ▼ 📁 书签栏                      │
│   ├─ 📁 开发工具                  │
│   ├─ 📁 学习资源                  │
│   └─ 📁 常用网站                  │
│ ▼ 📁 其他书签                    │
│   ├─ 📁 临时收藏                  │
│   └─ 📁 待整理                    │
│ ▶ 📁 移动设备书签                │
└─────────────────────────────────────┘

💡 只显示选中文件夹及其子文件夹中的书签
```

### 主页效果

**选择"书签栏/开发工具"后**:
```
🔍 搜索书签...

📁 前端工具                    3 项
  🔖 VS Code
  🔖 Chrome DevTools
  🔖 React DevTools

📁 后端工具                    2 项
  🔖 Postman
  🔖 MongoDB Compass
```

## 使用场景

### 1. **工作场景分离**
- 工作书签：选择"工作"文件夹
- 个人书签：选择"个人"文件夹
- 学习书签：选择"学习"文件夹

### 2. **项目专注**
- 当前项目：选择特定项目文件夹
- 减少干扰：隐藏无关书签
- 提高效率：快速找到相关资源

### 3. **分类管理**
- 按主题分类：技术、娱乐、购物等
- 按优先级：常用、偶尔使用、备用等
- 按时间：最新、归档等

## 配置示例

### 开发者配置
```
根目录: 📁 开发工具
├─ 📁 前端
│   ├─ 🔖 React 文档
│   ├─ 🔖 Vue 文档
│   └─ 🔖 TypeScript 文档
├─ 📁 后端
│   ├─ 🔖 Node.js 文档
│   └─ 🔖 Express 文档
└─ 📁 工具
    ├─ 🔖 GitHub
    └─ 🔖 Stack Overflow
```

### 学生配置
```
根目录: 📁 学习资源
├─ 📁 课程
│   ├─ 🔖 在线课程平台
│   └─ 🔖 教学视频
├─ 📁 参考资料
│   ├─ 🔖 学术论文
│   └─ 🔖 参考书籍
└─ 📁 工具
    ├─ 🔖 笔记软件
    └─ 🔖 思维导图
```

## 最佳实践

### 1. **文件夹组织**
- 使用清晰的命名规范
- 建立合理的层级结构
- 定期整理和清理

### 2. **根目录选择**
- 根据使用场景选择合适的根目录
- 避免过深的文件夹层级
- 保持文件夹内容的相关性

### 3. **设置管理**
- 根据工作流程调整根目录
- 利用搜索功能快速定位
- 定期检查和更新设置

## 故障排除

### 常见问题

1. **文件夹不显示**
   - 检查文件夹是否为空
   - 确认文件夹包含书签或子文件夹
   - 重新加载插件

2. **设置不生效**
   - 检查浏览器存储权限
   - 清除浏览器缓存
   - 重新选择根目录

3. **加载失败**
   - 检查网络连接
   - 确认书签权限
   - 查看控制台错误信息

### 性能优化

1. **缓存机制**: 缓存文件夹列表减少API调用
2. **懒加载**: 按需加载文件夹内容
3. **防抖处理**: 避免频繁的设置更新

## 未来扩展

1. **多根目录**: 支持同时选择多个根目录
2. **智能推荐**: 根据使用频率推荐根目录
3. **快速切换**: 添加根目录快速切换按钮
4. **导入导出**: 支持根目录设置的导入导出

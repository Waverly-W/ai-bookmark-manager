# 书签功能说明

## 概述

Chrome插件现在支持展示和管理浏览器收藏夹书签，用户可以在New Tab页面中方便地浏览和访问所有书签。

## 主要功能

### 📚 书签展示

1. **层级结构**: 完整展示Chrome书签的文件夹层级结构
2. **图标区分**: 
   - 📁 文件夹图标（蓝色）
   - 🔖 书签图标（琥珀色）
   - 🔗 外部链接图标（悬停时显示）
3. **展开/收起**: 文件夹支持点击展开和收起
4. **书签统计**: 显示总书签数量

### ⚙️ 根目录设置

1. **文件夹选择**: 在设置页面选择要显示的书签根目录
2. **全部书签**: 默认显示所有书签文件夹
3. **特定文件夹**: 可选择只显示某个文件夹及其子文件夹
4. **实时更新**: 设置更改后主页书签立即更新

### 🔍 搜索功能

1. **实时搜索**: 输入关键词即时过滤书签
2. **递归搜索**: 搜索包含子文件夹中的书签
3. **智能匹配**: 匹配书签标题和URL
4. **搜索图标**: 搜索框带有放大镜图标

### 🎨 界面设计

1. **极简头部**: 仅保留居中的搜索框，移除标题和统计信息等装饰性元素
2. **卡片布局**: 使用响应式网格卡片布局展示书签和文件夹
3. **单行布局**: 所有元素在一行内显示，简洁紧凑
4. **统一样式**: 文件夹和书签使用相同的卡片组件，通过图标区分
5. **图标区分**: 文件夹（📁蓝色容器）、书签（🌐统一容器+真实favicon）
6. **智能图标**: 书签显示真实网站favicon，获取失败时使用默认图标
7. **统一样式**: 所有图标使用32x32像素圆角容器，确保视觉一致性
8. **文本截断**: 名称过长时自动截断，保持单行显示
9. **悬停效果**: 卡片悬停时有缩放和阴影效果
10. **响应式设计**: 根据屏幕尺寸自动调整网格列数

### 🎯 交互功能

1. **文件夹导航**: 点击文件夹卡片进入该文件夹
2. **书签打开**: 点击书签卡片在新标签页中打开
3. **层级浏览**: 每次只显示当前层级的内容
4. **面包屑导航**: 极简设计，纯文字导航，低调融入背景，支持点击跳转
5. **返回功能**: 简约的返回按钮，仅通过颜色变化提供反馈

## 技术实现

### Chrome API使用

```typescript
// 获取书签树
const bookmarkTree = await browser.bookmarks.getTree();

// 打开书签
await browser.tabs.create({ url: bookmarkUrl });
```

### 权限配置

```typescript
// wxt.config.ts
permissions: ["storage", "tabs", "contextMenus", "bookmarks"]
```

### Favicon技术特性

1. **五级获取策略**: 依次尝试5种方法获取网站图标
   - 根目录favicon.ico
   - HTML源码解析
   - Favicon Grabber API
   - Google Favicon API
   - DuckDuckGo Favicon API

2. **智能缓存系统**:
   - 7天本地缓存
   - 自动过期清理
   - 32x32像素优化
   - Data URL格式存储

3. **性能优化**:
   - 异步预加载
   - 5秒超时控制
   - 错误容忍机制
   - 优雅降级方案

4. **统一样式设计**:
   - 32x32像素圆角容器
   - 渐变背景和边框装饰
   - 明暗主题自动适配
   - 悬停动画和阴影效果

### 数据结构

```typescript
interface BookmarkNode {
    id: string;
    title: string;
    url?: string;           // 书签URL（文件夹没有）
    children?: BookmarkNode[]; // 子节点（文件夹有）
    parentId?: string;
    index?: number;
    dateAdded?: number;
    dateGroupModified?: number;
}
```

### 组件架构

1. **Bookmarks**: 主组件，负责数据获取和状态管理
2. **BookmarkItem**: 递归组件，渲染单个书签或文件夹
3. **搜索逻辑**: 递归搜索匹配的书签项

## 用户界面

### 书签卡片

- **标题**: "书签" + 总数统计
- **搜索框**: 带图标的搜索输入框
- **内容区域**: 可滚动的书签列表（最大高度96）

### 文件夹显示

```
📁 书签栏                    5 项
  🔖 Google
  🔖 GitHub
  📁 开发工具                2 项
    🔖 VS Code
    🔖 Chrome DevTools
```

### 状态显示

1. **加载中**: 显示旋转加载动画
2. **错误状态**: 显示错误信息和重试按钮
3. **空状态**: 显示"暂无书签"提示

## 国际化支持

### 中文文本
- `bookmarks`: "书签"
- `searchBookmarks`: "搜索书签"
- `bookmarksTotal`: "个书签"
- `noBookmarks`: "暂无书签"
- `bookmarksLoadError`: "加载书签失败"
- `loading`: "加载中..."
- `retry`: "重试"
- `items`: "项"

### 英文文本
- `bookmarks`: "Bookmarks"
- `searchBookmarks`: "Search bookmarks"
- `bookmarksTotal`: "bookmarks"
- `noBookmarks`: "No bookmarks found"
- `bookmarksLoadError`: "Failed to load bookmarks"
- `loading`: "Loading..."
- `retry`: "Retry"
- `items`: "items"

## 使用方法

### 基本操作

1. **设置根目录**: 在设置页面选择要显示的书签根目录
2. **查看书签**: 打开New Tab页面，书签以卡片网格形式显示
3. **进入文件夹**: 点击文件夹卡片进入该文件夹
4. **打开书签**: 点击书签卡片在新标签页中打开
5. **层级导航**: 使用面包屑导航在不同层级间跳转
6. **搜索书签**: 在搜索框中输入关键词过滤书签

### 高级功能

1. **根目录过滤**: 通过设置根目录只显示特定文件夹的书签
2. **层级导航**: 支持多层嵌套文件夹的逐级浏览
3. **面包屑导航**: 清晰显示当前位置和导航路径
4. **搜索跨层级**: 搜索时显示所有匹配结果，不受层级限制
5. **智能图标**: 自动获取和缓存网站favicon，提供真实的视觉体验
6. **离线缓存**: favicon缓存7天，支持离线浏览
7. **批量管理**: 通过搜索快速定位特定书签

## 故障排除

### 常见问题

1. **书签不显示**
   - 检查插件是否有bookmarks权限
   - 确保浏览器中有书签数据
   - 重新加载插件

2. **搜索不工作**
   - 清空搜索框重试
   - 检查书签标题是否包含搜索关键词
   - 尝试搜索URL关键词

3. **点击书签无反应**
   - 检查书签URL是否有效
   - 确保插件有tabs权限
   - 查看浏览器控制台错误信息

### 性能优化

1. **虚拟滚动**: 大量书签时使用虚拟滚动提升性能
2. **搜索防抖**: 搜索输入使用防抖减少计算
3. **懒加载**: 文件夹内容按需加载

## 最佳实践

1. **书签整理**: 建议将书签按类别整理到不同文件夹
2. **命名规范**: 使用清晰的书签标题便于搜索
3. **定期清理**: 删除无效或重复的书签
4. **分类管理**: 使用文件夹对书签进行分类管理

## 设置功能

### 🔧 Tab式设置页面

1. **设置入口**: 通过侧边栏的设置按钮进入设置页面
2. **Tab分类**: 使用标签页将设置分为"书签设置"和"外观设置"两类
3. **独立布局**: 每个Tab独立渲染，避免高度联动问题
4. **响应式设计**: 适配不同屏幕尺寸，提供一致的用户体验

### 📚 书签设置Tab

1. **级联面板选择**: 使用macOS Finder风格的级联面板选择书签根目录
2. **悬停展开**: 鼠标悬停即可展开子文件夹面板，操作更直观
3. **实时预览**: 选择后立即在主页生效
4. **持久化存储**: 设置保存在Chrome本地存储中
5. **固定高度**: 组件高度固定，不影响页面布局稳定性

### 🎨 外观设置Tab

1. **界面语言**: 支持中文简体和English切换
2. **主题设置**: 支持明亮和暗黑主题切换
3. **强调色设置**: 支持7种预设颜色（紫色、蓝色、绿色、橙色、红色、粉色、青色）
4. **三列布局**: 三个设置项使用网格布局并排显示（大屏幕）
5. **即时应用**: 选择强调色后立即应用到全局UI元素
6. **高度固定**: 布局稳定，不受其他设置项影响

## 未来扩展

1. **书签编辑**: 支持在插件中编辑书签
2. **书签同步**: 支持跨设备书签同步
3. **标签系统**: 为书签添加标签功能
4. **使用统计**: 显示书签访问频率统计
5. **更多设置Tab**: 可以轻松添加新的设置分类

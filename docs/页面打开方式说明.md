# Chrome插件页面打开方式说明

## 当前可用的页面

### 1. Popup页面 ✅
- **打开方式**: 直接点击Chrome插件图标
- **文件位置**: `entrypoints/popup/`
- **功能**: 显示一个小的弹出窗口
- **特点**: 
  - 简洁的界面
  - 可以发送消息到background script
  - 适合快速操作

### 2. New Tab页面 ✅
- **打开方式**:
  - 自动: 打开新标签页时自动显示
  - 手动: 右键点击插件图标 → 选择"打开新标签页"
- **文件位置**: `entrypoints/newtab/`
- **功能**: 替换Chrome浏览器默认的新标签页
- **特点**:
  - 全屏显示空间
  - 完整的React应用
  - 支持主题和国际化
  - 包含主页和设置页面
  - **界面**: 侧边栏已移至左侧，提供更好的用户体验

### 3. ~~Content Script页面~~ ❌ **已删除**
- **状态**: 已从项目中完全移除
- **原因**: 简化项目结构，专注于New Tab和Popup功能

### 3. Background Script ✅
- **文件位置**: `entrypoints/background.ts`
- **功能**: 后台服务脚本
- **特点**:
  - 处理插件图标点击事件
  - 管理消息传递
  - 创建右键菜单

## 使用方法

### 安装插件
1. 运行 `npm run build` 构建项目
2. 打开Chrome浏览器，进入 `chrome://extensions/`
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择 `.output/chrome-mv3` 目录

### 测试各个页面
1. **测试Popup**: 直接点击插件图标
2. **测试New Tab**:
   - 自动测试: 按Ctrl+T打开新标签页
   - 手动测试: 右键点击插件图标 → 选择"打开新标签页"
   - **注意**: 侧边栏现在位于左侧

## 技术实现

### 右键菜单配置
在 `background.ts` 中添加了右键菜单：
```typescript
browser.contextMenus.create({
    id: "openSidePanel",
    title: "打开侧边栏",
    contexts: ["action"]
});
```

### 权限配置
在 `wxt.config.ts` 中配置了必要权限：
```typescript
permissions: ["storage", "tabs", "contextMenus"]
```
**注意**: 移除了`activeTab`和`scripting`权限，因为不再需要content script功能。

### New Tab配置
WXT自动在manifest.json中添加：
```json
"chrome_url_overrides": {
    "newtab": "newtab.html"
}
```

### 消息传递
各个页面通过Chrome Extension API进行消息传递：
- Background ↔ Content Script
- Background ↔ Popup
- Background ↔ Side Panel

## 故障排除

### 常见错误及解决方案

#### 1. "Could not establish connection. Receiving end does not exist."

**原因**:
- Content Script未加载或加载失败
- 向不支持的页面发送消息（如chrome://页面）
- 消息格式不正确

**解决方案**:
- 确保在支持的网页上测试（避免chrome://页面）
- 检查浏览器控制台的错误信息
- 重新加载插件和网页

#### 2. Popup页面无法打开

**原因**:
- Side Panel自动打开设置冲突
- Popup文件路径错误

**解决方案**:
- 确保background.ts中注释了`openPanelOnActionClick`设置
- 检查popup目录名称是否正确

#### 3. Content Script不显示

**原因**:
- 网页不支持Content Script注入
- CSS样式冲突
- 消息传递失败

**解决方案**:
- 在普通网页上测试（如百度、谷歌等）
- 检查浏览器开发者工具的控制台
- 确保插件权限正确

### 调试技巧

1. **查看Background Script日志**:
   - 打开 `chrome://extensions/`
   - 点击插件的"检查视图 service worker"

2. **查看Content Script日志**:
   - 在网页上按F12打开开发者工具
   - 查看Console标签页

3. **查看Popup日志**:
   - 右键点击插件图标
   - 选择"检查弹出内容"

## 注意事项

1. **Content Script功能已完全移除**，简化了项目结构
2. **Popup页面**点击外部区域会自动关闭
3. **New Tab页面**会替换浏览器默认的新标签页，提供完整的插件功能界面
4. **侧边栏位置**已从右侧移至左侧，提供更好的用户体验
5. 所有页面都支持主题切换和国际化功能
6. **重要**: 安装插件后，所有新打开的标签页都会显示插件的New Tab页面
